<!-- CubeDood: ReCubed Sound Test -->
<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>CubeDood: ReCubed | SoundTest</title>
	</head>
	<style>
		canvas {
		display: block;
		margin: auto;
		border-color:white;
		border-style:solid;
		}
		body {
		background-color:black;
		}
	</style>
	<body>
		<canvas id="gameCanvas" width="800" height="640"></canvas>
	</body>
	<script>
		const ctx = document.getElementById("gameCanvas").getContext("2d");
		
		const width = 800;
		const height = 640;
		
		const st_music = [
			{
				name: "4 Sided Blighted",
				description: "A chill, mysterious beat, mainly for background music and cutscenes.",
				file: "assets/ost/4 Sided Blighted.mp3",
				game: "CubeDood in 'The Memory Snatcher'"
			},
			{
				name: "Angie",
				description: "For Angie, someone close to me.",
				file: "assets/ost/Angie.wav",
				game: "CubeDood: ReCubed"
			},
			{
				name: "Another Day Another Vibe",
				description: "A jazzy lofi beat, for when you're feeling down, or in the settings menu.",
				file: "assets/ost/Another Day Another Vibe.wav",
				game: "CubeDood: ReCubed"
			},
			{
				name: "Blast from the Past",
				description: "This song will shoot you back to the original CubeDood!",
				file: "assets/ost/Blast from the Past.mp3",
				game: "CubeDood in 'The Memory Snatcher'"
			},
			{
				name: "BOLT and DASH!",
				description: "A remix of BOLT! from the original CubeDood, now with a louder piano, and a groovier drum.",
				file: "assets/ost/BOLT and DASH!.mp3",
				game: "CubeDood vs The World!"
			},
			{
				name: "BOLT!",
				description: "One of the classic level songs used in the first CubeDood.",
				file: "assets/ost/BOLT!.mp3",
				game: "CubeDood in 'The Memory Snatcher'"
			},
			{
				name: "Brutish Fighter, Cubed and Everything!",
				description: "The boss battle theme for CubeBrute, from the cancelled 'CubeDood vs The World!'.",
				file: "assets/ost/Brutish Fighter, Cubed and Everything!.mp3",
				game: "CubeDood vs The World!"
			},
			{
				name: "Cubed and Dash",
				description: "A very, very loud rock + jazz combination, for harder levels.",
				file: "assets/ost/Cubed and Dash.mp3",
				game: "CubeDood vs The World!"
			},
			{
				name: "CubeTops Revenge; Return of the Hero",
				description: "CubeTop is back, and this time, he isn't playing games.",
				file: "assets/ost/CubeTops Revenge; Return of the Hero.mp3",
				game: "CubeDood vs The World!"
			},
			{
				name: "Cylinder Blunder",
				description: "Very fast and jazzy, with great Marimbas, along with a amazing Saxophone.",
				file: "assets/ost/Cylinder Blunder.mp3",
				game: "CubeDood vs The World!"
			},
			{
				name: "Dance With Me CubeDood!",
				description: "CubeTop's boss battle theme. 'Dance with me, CubeDood! It will surely be your last!' - CubeTop",
				file: "assets/ost/Dance With Me CubeDood!.mp3",
				game: "CubeDood vs The World!"
			},
			{
				name: "Et tu, Cube",
				description: "Level theme for anything sneaky, or fast pased. Also used for challenge levels.",
				file: "assets/ost/Et tu, Cube.mp3",
				game: "CubeDood vs The World!"
			},
			{
				name: "Fight with Might",
				description: "A very chill theme for CubeDood vs The World!'s level editor.",
				file: "assets/ost/Fight with Might.mp3",
				game: "CubeDood vs The World!"
			},
			{
				name: "Fire at will!",
				description: "A hidden song that would only play if CubeDood collected all of the Cubed Coins.",
				file: "assets/ost/Fire at will!.mp3",
				game: "CubeDood vs The World!"
			},
			{
				name: "Functional Equation",
				description: "The level editor theme from CubeDood in 'The Memory Snatcher'. A very relaxed jazz song.",
				file: "assets/ost/Functional Equation.mp3",
				game: "CubeDood in 'The Memory Snatcher'"
			},
			{
				name: "Keep it plane",
				description: "A super freaking energetic song, meant to be the original CubeDood: ReCubed title theme.",
				file: "assets/ost/Keep it plane.mp3",
				game: "CubeDood: ReCubed"
			},
			{
				name: "Lead me in the right Direction",
				description: "A much faster remix of 'Swing in the Right Direction' from the Original CubeDood.",
				file: "assets/ost/Lead me in the right Direction.wav",
				game: "CubeDood: ReCubed"
			},
			{
				name: "Maximus Square",
				description: "The title theme for CubeDood vs The World!",
				file: "assets/ost/Maximus Square.mp3",
				game: "CubeDood vs The World!"
			},
			{
				name: "Meeting with the Cube",
				description: "Level editor theme and Settings theme from the Original CubeDood.",
				file: "assets/ost/Meeting with the Cube.mp3",
				game: "CubeDood in 'The Memory Snatcher'"
			},
			{
				name: "Quadrilateral Collateral",
				description: "CubeTop's boss battle theme from the Original CubeDood.",
				file: "assets/ost/Quadrilateral Collateral.mp3",
				game: "CubeDood in 'The Memory Snatcher'"
			},
			{
				name: "Return of CubeTop",
				description: "CubeTop's theme song, from the original CubeDood.",
				file: "assets/ost/Return of CubeTop.mp3",
				game: "CubeDood in 'The Memory Snatcher'"
			},
			{
				name: "Revival",
				description: "The CubeDood: ReCubed title theme.",
				file: "assets/ost/Revival.wav",
				game: "CubeDood: ReCubed"
			},
			{
				name: "Shadows",
				description: "A hidden song in CubeDood: ReCubed, but I'm not going to tell you how to find it. :P",
				file: "assets/ost/Shadows.wav",
				game: "CubeDood: ReCubed"
			},
			{
				name: "Simply Squared",
				description: "A bonus song included in CubeDood vs The World!, meant to be used in level editor levels.",
				file: "assets/ost/Simply Squared.mp3",
				game: "CubeDood vs The World!"
			},
			{
				name: "Sine-Cosine-Tangent",
				description: "Another level editor theme for CubeDood: ReCubed",
				file: "assets/ost/Sine-Cosine-Tangent.wav",
				game: "CubeDood: ReCubed"
			},
			{
				name: "Sound Test",
				description: "The default sound test song from CubeDood vs The World!",
				file: "assets/ost/Sound Test.mp3",
				game: "CubeDood vs The World!"
			},
			{
				name: "Squared Impared",
				description: "A song that plays after you beat the game in the Original CubeDood.",
				file: "assets/ost/Squared Impared.mp3",
				game: "CubeDood in 'The Memory Snatcher'"
			},
			{
				name: "Swing in the right Direction",
				description: "Level song for more advanced and harder levels in CubeDood in 'The Memory Snatcher'.",
				file: "assets/ost/Swing in the right Direction.mp3",
				game: "CubeDood in 'The Memory Snatcher'"
			},
			{
				name: "The Memory Snatcher",
				description: "The title theme for CubeDood in 'The Memory Snatcher'",
				file: "assets/ost/The Memory Snatcher.mp3",
				game: "CubeDood in 'The Memory Snatcher'"
			},
			{
				name: "The Narcissist",
				description: "Theme song for Cubie, originating from CubeDood vs The World!",
				file: "assets/ost/The Narcissist.mp3",
				game: "CubeDood vs The World!"
			},
			{
				name: "The Second Dimention",
				description: "An alternate version of the title screen theme for CubeDood: ReCubed",
				file: "assets/ost/The Second Dimention.wav",
				game: "CubeDood: ReCubed"
			}
		];
		
		let currentIndex = 0;
		let currentSong = new Audio(st_music[currentIndex].file);
		let songDuration = 0;
		let progressBarWidth = 400;
		
		var lastUpdateTime = performance.now();
		var deltaTime = 0;
		var fpsInterval = 1000 / 60;
		
		const logo = new Image();
		logo.src = "assets/game/logo.png";
		
		const flag = new Image();
		flag.src = "assets/game/flag.png";
		
		document.addEventListener("keydown", function(event) {
		    if (event.code === "ArrowUp") {
		        currentIndex = (currentIndex - 1 + st_music.length) % st_music.length;
		        updateSelectedSong();
		    } else if (event.code === "ArrowDown") {
		        currentIndex = (currentIndex + 1) % st_music.length;
		        updateSelectedSong();
		    } else if (event.code === "Space") {
		        playSelectedSong();
		    }
		});
		
		function updateSelectedSong() {
		    currentSong.pause();
		    currentSong.currentTime = 0; 
		    currentSong = new Audio(st_music[currentIndex].file); 
		
		  currentSong.addEventListener('loadedmetadata', () => {
		      songDuration = currentSong.duration; 
		  });
		
		    currentSong.play();
		}
		
		function playSelectedSong() {
		    if (!currentSong.paused) {
		        currentSong.pause();
		    } else {
		        currentSong.play(); 
		    }
		}
		
		function update()
		{
			requestAnimationFrame(update);
		
		var currentTime = performance.now();
		var elapsed = currentTime - lastUpdateTime;
		
		deltaTime += elapsed;
		draw();
		
		while (deltaTime >= fpsInterval)
		{
			deltaTime -= fpsInterval;
		}
		
		lastUpdateTime = currentTime;
		}
		
		function draw()
		{
		draw_backgroundColor("orange");
		
		    ctx.drawImage(flag, width / 3 + 67, 30, 32, 32);
		ctx.drawImage(logo, width / 3, 50, 261, 76);
		
		    draw_cubedood(width / 3 + 260, 80);
		    draw_text("ReCubed", width / 3 + 133, 140, "30");
		
		    draw_text("Track " + currentIndex, width / 5, 200, "20");
		    draw_text(st_music[currentIndex].name, width / 5, 240, "30");
		    draw_text(st_music[currentIndex].description, width / 5, 270, "15");
		
		    draw_text("Controls: Up / Down Arrows keys to change the track, Space to play/pause", width / 5, 600, "15");
		
		    draw_progress_bar(width / 5, 310, progressBarWidth, 20); 
		}
		
		function draw_backgroundColor(color)
		{
		ctx.fillStyle = color;
		ctx.fillRect(0, 0, 800, 640);
		}
		
		function draw_cubedood(x, y)
		  {
		    ctx.fillStyle = "white";
		    ctx.beginPath();
		    ctx.rect(x, y, 32, 32);
		    ctx.fill();
		    ctx.closePath();
		
		    ctx.fillStyle = "black";
		    ctx.fillRect(x + 8, y + 8, 8, 8);
		    ctx.fillRect(x + 24, y + 8, 8, 8);
		  }
		
		function draw_text(text, x, y, size)
		{
		  ctx.fillStyle = "black";
		  ctx.font = size + "px Roboto";
		  ctx.fillText(text, x, y);
		}
		
		function draw_progress_bar(x, y, width, height) {
		    let progress = currentSong.currentTime / songDuration;
		  
		    ctx.fillStyle = "gray";
		    ctx.fillRect(x, y, width, height);
		
		    ctx.fillStyle = "white";
		    ctx.fillRect(x, y, progress * width, height);
		
		    draw_text(format_time(currentSong.currentTime) + " / " + format_time(songDuration), x + 10, y - 10);
		}
		
		function format_time(seconds) {
		    let mins = Math.floor(seconds / 60);
		    let secs = Math.floor(seconds % 60);
		    return mins + ":" + (secs < 10 ? "0" : "") + secs;
		}
		
		function draw_image(image, x, y, width, height)
		{
		ctx.drawImage(image, x, y, width, height);
		}
		
		requestAnimationFrame(update);
		updateSelectedSong();
			
	</script>
</html>
